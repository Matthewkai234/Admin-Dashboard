<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
    <link href="/static/css/styles.css" rel="stylesheet" />

    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>

    <title>Admin Dashboard - <%= title %></title>
    <style>
        .card {
            transition: transform 0.3s;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .counter {
            font-size: 2.5rem;
            font-weight: bold;
        }

        .highlight-year {
            color: #ff6347; /* Tomato color */
            font-weight: bold;
        }

        .chart-card {
            background-color: #6f42c1; /* Purple color */
        }

        .table-card {
            background-color: #28a745; /* Green color */
        }
    </style>
</head>

<body class="sb-nav-fixed">
    <%- include('partials/navbar') %>
    <div id="layoutSidenav">
        <%- include('partials/sidenav') %>
        <div id="layoutSidenav_content">
            <main>
                <div class="container-fluid px-4">
                    <h1 class="mt-4" id="userWelcome">Dashboard</h1>
                    
                    <div class="row mb-4">
                        <div class="col">
                            <h3>Welcome to the Movies Dashboard</h3>
                            <div class="counter" id="moviesCounter">0</div>
                            <p>With more than 10 genres</p>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <h4>Charts</h4>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xl-4 col-md-6 mb-4">
                            <div class="card chart-card text-white h-100">
                                <div class="card-body d-flex align-items-center justify-content-between">
                                    <div class="card-body-icon">
                                        <i class="fas fa-chart-bar fa-2x"></i>
                                    </div>
                                    <div class="mr-5">Movies Per Year Chart</div>
                                </div>
                                <a class="card-footer text-white clearfix small z-1" href="movies-per-year-chart">
                                    <span class="float-left">Open Chart</span>
                                    <span class="float-right">
                                        <i class="fas fa-angle-right"></i>
                                    </span>
                                </a>
                            </div>
                        </div>
                        <div class="col-xl-4 col-md-6 mb-4">
                            <div class="card chart-card text-white h-100">
                                <div class="card-body d-flex align-items-center justify-content-between">
                                    <div class="card-body-icon">
                                        <i class="fas fa-chart-pie fa-2x"></i>
                                    </div>
                                    <div class="mr-5">Movies Per Genre Chart</div>
                                </div>
                                <a class="card-footer text-white clearfix small z-1" href="movies-per-genre-chart">
                                    <span class="float-left">Open Chart</span>
                                    <span class="float-right">
                                        <i class="fas fa-angle-right"></i>
                                    </span>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <h4>Tables</h4>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xl-4 col-md-6 mb-4">
                            <div class="card table-card text-white h-100">
                                <div class="card-body d-flex align-items-center justify-content-between">
                                    <div class="card-body-icon">
                                        <i class="fas fa-link fa-2x"></i>
                                    </div>
                                    <div class="mr-5">Links Table</div>
                                </div>
                                <a class="card-footer text-white clearfix small z-1" href="table-links">
                                    <span class="float-left">See Data</span>
                                    <span class="float-right">
                                        <i class="fas fa-angle-right"></i>
                                    </span>
                                </a>
                            </div>
                        </div>
                        <div class="col-xl-4 col-md-6 mb-4">
                            <div class="card table-card text-white h-100">
                                <div class="card-body d-flex align-items-center justify-content-between">
                                    <div class="card-body-icon">
                                        <i class="fas fa-table fa-2x"></i>
                                    </div>
                                    <div class="mr-5">Movies Table</div>
                                </div>
                                <a class="card-footer text-white clearfix small z-1" href="table-movies">
                                    <span class="float-left">See Data</span>
                                    <span class="float-right">
                                        <i class="fas fa-angle-right"></i>
                                    </span>
                                </a>
                            </div>
                        </div>
                        <div class="col-xl-4 col-md-6 mb-4">
                            <div class="card table-card text-white h-100">
                                <div class="card-body d-flex align-items-center justify-content-between">
                                    <div class="card-body-icon">
                                        <i class="fas fa-tags fa-2x"></i>
                                    </div>
                                    <div class="mr-5">Tags Table</div>
                                </div>
                                <a class="card-footer text-white clearfix small z-1" href="table-tags">
                                    <span class="float-left">See Data</span>
                                    <span class="float-right">
                                        <i class="fas fa-angle-right"></i>
                                    </span>
                                </a>
                            </div>
                        </div>
                        <div class="col-xl-4 col-md-6 mb-4">
                            <div class="card table-card text-white h-100">
                                <div class="card-body d-flex align-items-center justify-content-between">
                                    <div class="card-body-icon">
                                        <i class="fas fa-star fa-2x"></i>
                                    </div>
                                    <div class="mr-5">Ratings Table</div>
                                </div>
                                <a class="card-footer text-white clearfix small z-1" href="table-ratings">
                                    <span class="float-left">See Data</span>
                                    <span class="float-right">
                                        <i class="fas fa-angle-right"></i>
                                    </span>
                                </a>
                            </div>
                        </div>
                        <div class="col-xl-4 col-md-6 mb-4">
                            <div class="card table-card text-white h-100">
                                <div class="card-body d-flex align-items-center justify-content-between">
                                    <div class="card-body-icon">
                                        <i class="fas fa-dna fa-2x"></i>
                                    </div>
                                    <div class="mr-5">Genome Tags Table</div>
                                </div>
                                <a class="card-footer text-white clearfix small z-1" href="table-genome-tags">
                                    <span class="float-left">See Data</span>
                                    <span class="float-right">
                                        <i class="fas fa-angle-right"></i>
                                    </span>
                                </a>
                            </div>
                        </div>
                        <div class="col-xl-4 col-md-6 mb-4">
                            <div class="card table-card text-white h-100">
                                <div class="card-body d-flex align-items-center justify-content-between">
                                    <div class="card-body-icon">
                                        <i class="fas fa-clipboard-list fa-2x"></i>
                                    </div>
                                    <div class="mr-5">Genome Scores Table</div>
                                </div>
                                <a class="card-footer text-white clearfix small z-1" href="table-genome-scores">
                                    <span class="float-left">See Data</span>
                                    <span class="float-right">
                                        <i class="fas fa-angle-right"></i>
                                    </span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            <%- include('partials/footer') %>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const sidebarToggle = document.body.querySelector('#sidebarToggle');
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function (event) {
                    event.preventDefault();
                    document.body.classList.toggle('sb-sidenav-toggled');
                });
            }
        });

        async function fetchUserData() {
            try {
                const response = await fetch('/api/user');
                const data = await response.json();
                if (data.email) {
                    const fullName = `${data.firstName} ${data.lastName}`;
                    const firstName = `${data.firstName}`;

                    document.getElementById('username').textContent = fullName;
                    document.getElementById("userWelcome").textContent = "👋 Hello, " + firstName + "!";
                } else {
                    document.getElementById('username').textContent = 'Guest';
                    document.getElementById("userWelcome").textContent = "Welcome to the movies dashboard";
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
                document.getElementById('username').textContent = 'Guest';
            }
        }

        window.addEventListener('DOMContentLoaded', fetchUserData);

        function animateCounter(element, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                element.innerHTML = Math.floor(progress * (end - start) + start) + ' Movies from <span class="highlight-year">1878</span> to <span class="highlight-year">2019</span>';
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const counterElement = document.getElementById('moviesCounter');
            animateCounter(counterElement, 0, 62423, 4000);
        });
    </script>
</body>

</html>